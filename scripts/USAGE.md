# $ \LaTeX $ in Flag4j Javadoc

---

## 1. What, $ \LaTeX $ in Javadoc? 

That's right! Your eyes do not deceive!
Flag4j supports using $ \LaTeX $ in the web-based Javadoc API. How is this achieved you may ask?
By injecting the MathJax script into all HTML files generated by the Javadoc doclet. Then 
a script is run to replace HTML based equations with $ \LaTeX $ equations to be rendered by MathJax. 
The Javadoc comments must be formatted correctly for this to work.

## 2. Doc Comment Syntax
To generate $ \LaTeX $ within the web-based Javadoc API, you must provide an HTML equation
for simple rendering within an IDE. This allows users to avoid seeing raw $ \LaTeX $
in the docs rendered by the IDE. This is because IDEs do not generally support JavaScript
in their simplified doc rendering. 

You can then optionally provide a $ \LaTeX $ equation to replace the preceding HTML equation.
When the docs are built and deployed to the [Flag4j API website](https://jacobdwatters.github.io/Flag4j/).

### 2.1 Specifying An HTML Equation Is "$ \LaTeX $ Replaceable"
The following doc comment specifies that an equation is replaceable 
```
/**
 * <span class="latex-replaceable">
 * <pre>
 *               <sup>    </sup>[ T<sub>1</sub>     X*D<sub>1</sub>       Y   ]
 *   D<sup>-1</sup> P<sup>-1</sup> A P D = [  0  D<sub>1</sub><sup>-1</sup>*B<sub>1</sub>*D<sub>1</sub>  D<sub>1</sub><sup>-1</sup>*Z  ]
 *               <sup>    </sup>[  0      0         T<sub>2</sub>  ]</pre>
 * </span>
 */
```
The `<span class="latex-replaceable">` tag indicates that the following HTML equation may be replaced by
a $ \LaTeX $ equation when building the docs. This tag and the closing `</span>` <em>must</em>
be included for the equation to be replaced. If there is not a latex equations following this, the
tag will be ignored.

Providing the equation as HTML allows The  InteliJ IDE to render the equations as:
![image](../figures/intelij_doc_render.png)

This looks okay, but we know that $ \LaTeX $ could look SO much better!

### 2.2 Specifying A $ \LaTeX $ Equation
We do not want the $ \LaTeX $ equation to rendered in an IDE as raw text. To avoid this, we place
the equation inside a special HTML comment. The comment must begin with `<!-- LATEX:`.
```
/**
 * <!-- LATEX:
 * {@literal
 * $$ \begin{bmatrix}
 * T_1 & XD_1 & Y \\
 * \mathbf{0} & D_1^{-1}B_1D_1 & D_1^{-1}Z \\
 * \mathbf{0} & \mathbf{0} & T_2
 * \end{bmatrix}  $$
 * }
 * -->
 */
```

The HTML comment `<!-- LATEX: ... -->` must immediately follow the `<span 
class="latex-replaceable">...</span>`
block for it to be utilized (white space and newlines are allowed between the two). 
Otherwise, the $ \LaTeX $ comment will be ignored.

The `{@literal...}` doc tag is not required but highly recommend to avoid issues with special HTML characters.
For instance, in the given example, the `&` would be interpreted in HTML to mean the beginning of an entity reference 
(e.g. `&sigma;`).

## 2.3 Full Example
The full doc comment would look something like,
```
/**
 * Some stuff...
 *
 * <span class="latex-replaceable">
 * <pre>
 *               <sup>    </sup>[ T<sub>1</sub>     X*D<sub>1</sub>       Y   ]
 *   D<sup>-1</sup> P<sup>-1</sup> A P D = [  0  D<sub>1</sub><sup>-1</sup>*B<sub>1</sub>*D<sub>1</sub>  D<sub>1</sub><sup>-1</sup>*Z  ]
 *               <sup>    </sup>[  0      0         T<sub>2</sub>  ]</pre>
 * </span>
 *
 *
 * <!-- LATEX:
 * {@literal
 * $$ \begin{bmatrix}
 * T_1 & XD_1 & Y \\
 * \mathbf{0} & D_1^{-1}B_1D_1 & D_1^{-1}Z \\
 * \mathbf{0} & \mathbf{0} & T_2
 * \end{bmatrix}  $$
 * }
 * -->
 *
 * Some more stuff...
 */
```

The full regex used in python to match such instances is:
```
(<span class="latex-replaceable">.*?</span>)\s*<!-- LATEX:\s*({@literal\s*.*?\s*}\s*) -->
```
where `.*` will match <em>any</em> character including newlines. If the text in the generated 
HTML does not match this, no replacements will be made.

In an IDE, the $ \LaTeX $ in the comment will <em>not</em> be rendered. The user will <em>only</em> see the
HTML equation. Once the Javadocs are built, parsed, and deployed to the [Flag4j API website](https://jacobdwatters.github.io/Flag4j/),
the HTML equation will be fully replaced with the $ \LaTeX $ equation and MathJax will render it as:
![image](../figures/latex_in_javadoc.png)

Wow! That looks so much better! Enjoy your $ \LaTeX $.
